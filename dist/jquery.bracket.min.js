var A=a=>typeof a==='string';var _=a=>typeof a==='boolean';var c=a=>typeof a==='function';const{isArray:B}=Array;var F=this?.__assign||function(...args){F=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t};return F.apply(this,args)},g,{defineProperty:E}=Object;(function(C){C['EMPTY_BYE']='empty-bye';C['EMPTY_TBD']='empty-tbd';C['ENTRY_NO_SCORE']='entry-no-score';C['ENTRY_DEFAULT_WIN']='entry-default-win';C['ENTRY_COMPLETE']='entry-complete'})(g||(g={}));(function($){var D=(function(){function _A(bE){this.val=bE;if(bE instanceof _A)throw Error('Trying to wrap Option into an Option');if(this.val===void 0)throw Error('Option cannot contain undefined')}_A.of=bF=>new _A(bF);_A.empty=()=>new _A(null);_A.prototype.get=function(){if(this.val===null)throw Error('Trying to get() empty Option');return this.val};_A.prototype.orElse=function(bG){return this.val===null?bG:this.val};_A.prototype.orElseGet=function(bH){return this.val===null?bH():this.val};_A.prototype.map=function(f){return this.val===null?_A.empty():new _A(f(this.val))};_A.prototype.forEach=function(f){this.val!==null&&f(this.val);return this};_A.prototype.toNull=function(){return this.val===null?null:this.val};_A.prototype.isEmpty=function(){return this.val===null};return _A}()),_C=(function(){function bI(bJ,_B,bK){this.first=bJ;this.second=_B;this.matchData=bK;if(!bJ||!_B)throw Error('Cannot create ResultObject with undefined scores')}return bI}()),_d,_f=(function(){function bQ(bR,bS,bT,_D,_E){this.source=bR;this.nameOrGetter=bS;this.order=bT;this.seed=_D;this.score=_E;this.sibling=function(){throw Error('No sibling asigned')}}E(bQ.prototype,'name',{get:function(){return typeof this.nameOrGetter==='function'?this.nameOrGetter():this.nameOrGetter},set:function(bU){this.nameOrGetter=bU},enumerable:!1,configurable:!0});bQ.prototype.emptyBranch=function(){if(!this.name.isEmpty()){if(this.sibling().name.isEmpty())return _d.BYE;return _d.TBD}else try{var bV=this.source().emptyBranch();if(bV===_d.TBD)return _d.TBD;if(bV===_d.END)return _d.BYE;var bW=this.source().sibling().emptyBranch();if(bW===_d.TBD)return _d.TBD;return _d.BYE}catch(e){if(e instanceof h)return _d.END;throw Error('Unexpected exception type (message: \"'.concat(e.message,'\")'))}};return bQ}()),S=function(){throw new h},T=function(dI,m){return ()=>{var dJ=new _f(S, function(){return dI[m][0]}, D.of(_e.first()), D.of(m*2), D.empty());var dK=new _f(S, function(){return dI[m][1]}, D.of(_e.second()), D.of(m*2+1), D.empty());dJ.sibling=()=>dK;dK.sibling=()=>dJ;return[{source:function(){return dJ}},{source:function(){return dK}}]}},u=function(dL,dM){return dN=>{dN.css('top','');var dO=dN.height();dN.css({bottom:dM?'':-dO/2+'px',position:'absolute',top:dM?dL.el.height()/2-dO/2+'px':''})}},X=function(eC,eD){return ()=>{var eE=eD.el.height()/2-eC.height()/2;return eC.css({top:eE})}},y=function(eF){return (eG,eH)=>{var eI=eG.height()/4,eJ={height:0,shift:eI*2};return eH.winner().order.map(eK=>eK.map(eF?eJ:{height:0,shift:eI},eF?eJ:{height:-eI*2,shift:eI})).orElse(eJ)}},aD=(function(){function hA(hB,hC,hD,hE,hF){this.bracketCon=hB;this.initResults=hC;this.mkMatch=hD;this.isFirstBracket=hE;this.opts=hF;this.rounds=[]}E(hA.prototype,'el',{get:function(){return this.bracketCon},enumerable:!1,configurable:!0});hA.prototype.addRound=function(hG){var hH=this.rounds.length,hI=hH>0?D.of(this.rounds[hH-1]):D.empty(),hJ=this.initResults.map(function(r){return r[hH]===void 0?new _C(D.empty(), D.empty(), void 0):r[hH]});var hK=new aC(this, hI, hH, hJ, hG, this.mkMatch, this.isFirstBracket, this.opts);this.rounds.push(hK);return hK};hA.prototype.dropRound=function(){this.rounds.pop()};hA.prototype.round=function(id){return this.rounds[id]};hA.prototype.size=function(){return this.rounds.length};hA.prototype.final=function(){return this.rounds[this.rounds.length-1].match(0)};hA.prototype.winner=function(){return this.rounds[this.rounds.length-1].match(0).winner()};hA.prototype.loser=function(){return this.rounds[this.rounds.length-1].match(0).loser()};hA.prototype.render=function(){this.bracketCon.empty();for(var hL=0,hM=this.rounds;hL<hM.length;hL++){var hN=hM[hL];hN.render()}};hA.prototype.results=function(){return this.rounds.reduce(function(hO,r){return hO.concat([r.results()])},[])};return hA}()),aE=function(hP){if(hP<0)return{height:-hP,drop:!1};if(hP<2)return{height:0,drop:!0};return{height:hP,drop:!0}},aK=(function(){function jL(jM,jN,jO,jP,jQ,jR,jS,jT,jU,jV){this.round=jM;this.match=jN;this.seed=jO;this.renderCb=jQ;this.isFirstBracket=jR;this.opts=jS;this.resultId=jT;this.topCon=jU;this.renderAll=jV;this.connectorCb=D.empty();this.matchCon=$('<div class="match"></div>');this.teamCon=$('<div class="teamContainer"></div>');this.alignCb=null;this.matchUserData=!jP.isEmpty()?jP.get().matchData:void 0;if(!jS.save){var jW=this.matchUserData;this.teamCon.hover(function(){jS.onMatchHover(jW,!0)},function(){jS.onMatchHover(jW,!1)});this.teamCon.click(function(){jS.onMatchClick(jW)})}jN.a.name=jN.a.source().name;jN.b.name=jN.b.source().name;jN.a.score=jP.map(r=>r.first.toNull());jN.b.score=jP.map(r=>r.second.toNull());((!jN.a.name||!jN.b.name)&&(G(jN.a.score)||G(jN.b.score)))&&(console.warn('ERROR IN SCORE DATA: '.concat(jN.a.source().name,': ').concat(jN.a.score,', ').concat(jN.b.source().name,': ').concat(jN.b.score)),jN.a.score=jN.b.score=D.empty())}E(jL.prototype,'el',{get:function(){return this.matchCon},enumerable:!1,configurable:!0});jL.prototype.getRound=function(){return this.round};jL.prototype.setConnectorCb=function(cb){this.connectorCb=cb};jL.prototype.connect=function(jX){var jY=this,jZ=this.teamCon.height()/4,kA=this.matchCon.height()/2;this.teamCon.append(aF(this.opts.roundMargin,jX.map(function(kB){return kB(jY.teamCon,jY)}).orElseGet(function(){if(jY.seed%2===0)return jY.winner().order.map(function(kC){return kC.map({height:kA,shift:jZ*(jY.opts.centerConnectors?2:1)},{height:kA-jZ*(jY.opts.centerConnectors?0:2),shift:jZ*(jY.opts.centerConnectors?2:3)})}).orElse({height:kA-jZ*(jY.opts.centerConnectors?0:1),shift:jZ*2});return jY.winner().order.map(function(kD){return kD.map({height:-kA+jZ*(jY.opts.centerConnectors?0:2),shift:-jZ*(jY.opts.centerConnectors?2:3)},{height:-kA,shift:-jZ*(jY.opts.centerConnectors?2:1)})}).orElse({height:-kA+jZ*(jY.opts.centerConnectors?0:1),shift:-jZ*2})}),this.opts.dir==='lr'?'right':'left'))};jL.prototype.winner=function(){return this.match.winner()};jL.prototype.loser=function(){return this.match.loser()};jL.prototype.first=function(){return this.match.a};jL.prototype.second=function(){return this.match.b};jL.prototype.setAlignCb=function(cb){this.alignCb=cb};jL.prototype.render=function(){var kE=this,kG=!this.match.a.name.isEmpty()&&!this.match.b.name.isEmpty(),kI=this.el.height()/2-this.teamCon.height()/2;this.matchCon.empty();this.teamCon.empty();this.match.a.name=this.match.a.source().name;this.match.b.name=this.match.b.source().name;this.match.a.seed=this.match.a.source().seed;this.match.b.seed=this.match.b.source().seed;var kF=this.match.a.name.isEmpty()&&this.match.b.name.isEmpty();if(kF)this.teamCon.addClass('np');else !this.match.winner().name?this.teamCon.addClass('np'):this.teamCon.removeClass('np');this.teamCon.append(aJ(this.round.roundNumber,this.match,this.match.a,this.match.b,kG,this.isFirstBracket,this.opts,this.resultId,this.topCon,this.renderAll));this.teamCon.append(aJ(this.round.roundNumber,this.match,this.match.b,this.match.a,kG,this.isFirstBracket,this.opts,this.resultId,this.topCon,this.renderAll));this.matchCon.appendTo(this.round.el);this.matchCon.append(this.teamCon);var kH=this.round.bracket.el.height()/this.round.size();this.el.css({height:kH});this.teamCon.css({top:kI});this.alignCb!==null&&this.alignCb(this.teamCon);var kJ=this.renderCb.map(function(kK){return kK(kE)}).orElse(!1);!kJ&&this.connect(this.connectorCb);this.opts.decorator.renderMatch(this.teamCon,this.matchUserData)};jL.prototype.results=function(){var kL=this.match.a.name.isEmpty()||this.match.b.name.isEmpty();kL&&(this.match.a.score=this.match.b.score=D.empty());return new _C(this.match.a.score, this.match.b.score, this.matchUserData)};return jL}()),aL=function(kM){return (kM===void 0?null:kM)},aM=function(kN){return kN.map(kO=>kO.map(kP=>kP.map(kQ=>new _C(D.of(aL(kQ[0])), D.of(aL(kQ[1])), kQ[2]))))},aN=function(kR){var kS=new aI;var kT=kR.init,kU=kT.results.length<=1,kV=kT.teams.length*45+kT.teams.length*kR.matchMargin,kW=$('<div class="jQBracket '+kR.dir+'"></div>').appendTo(kR.el.empty()),l,f,lA,lB;function kX(){var lD=aG(kT.teams.length,kU,kR.skipGrandFinalComeback,kR.skipSecondaryFinal,kT.results);kW.css({height:kU&&kT.teams.length<=2&&!kR.skipConsolationRound?kV+40:'',width:kR.disableToolbar?lD*(kR.teamWidth+kR.scoreWidth+kR.roundMargin)+10:lD*(kR.teamWidth+kR.scoreWidth+kR.roundMargin)+40})}var w;function kY(lE){kS.reset();w.render();l?.render();(f&&!kR.skipGrandFinalComeback)&&f.render();!kR.disableHighlight&&M(kW,w,f);if(lE){kT.results[0]=w.results();l&&(kT.results[1]=l.results());(f&&!kR.skipGrandFinalComeback)&&(kT.results[2]=f.results());kX();kR.save&&kR.save(aH(kT),kR.userData)}}(kR.skipSecondaryFinal&&kU)&&$.error('skipSecondaryFinal setting is viable only in double elimination mode');!kR.disableToolbar&&kW.append(aS(kT,kR));var kZ;if(kU)lA=$('<div class="bracket"></div>').appendTo(kW);else{!kR.skipGrandFinalComeback&&(kZ=$('<div class="finals"></div>').appendTo(kW));lA=$('<div class="bracket"></div>').appendTo(kW);lB=$('<div class="loserBracket"></div>').appendTo(kW)}lA.css({height:kV});lB?.css({height:kV/2});kX();var lC=function(lF,lG,lH,lI,lJ,lK,lL){return new aK(lF, lG, lH, lI, lJ, lK, lL, kS, kW, kY)};w=new aD(lA, D.of(kT.results[0]||null), lC, !0, kR);if(!kU){l=new aD(lB, D.of(kT.results[1]||null), lC, !1, kR);!kR.skipGrandFinalComeback&&(f=new aD(kZ, D.of(kT.results[2]||null), lC, !1, kR))}v(w,kT.teams,kU,kR,kR.skipGrandFinalComeback&&!kU);if(!kU){z(w,l,kT.teams.length,kR.skipGrandFinalComeback,kR.centerConnectors);!kR.skipGrandFinalComeback&&aA(f,w,l,kR,kX)}kY(!1);return{data:function(){return aH(kR.init)}}},aU=function(lW){if(!_(lW))throw Error('Value is not a boolean');return lW},aV=function(lX){var lY=aT(lX);if(lY<lX)throw Error('Value must be greater than '.concat(lX,', got ').concat(lY));return lY},aW=function(x){return x&(x-1)};(function(bL){bL[bL['TBD']=0]='TBD';bL[bL['BYE']=1]='BYE';bL[bL['END']=2]='END'})(_d||(_d={}));var _e=(function(){function bM(bN){this.isFirst=bN}bM.first=()=>new bM(!0);bM.second=()=>new bM(!1);bM.prototype.map=function(bO,bP){return this.isFirst?bO:bP};return bM}());function G(n){return !isNaN(parseFloat(n))&&isFinite(n)}function h(){this.message='Root of information for this team';this.name='EndOfBranchException'}var I=(function(){function bX(a,b){this.a=a;this.b=b}bX.teamsInResultOrder=bY=>{var bZ=bY.a.name.isEmpty(),cA=bY.b.name.isEmpty();if(cA&&!bZ){if(bY.b.emptyBranch()===_d.BYE)return[bY.a,bY.b];return[]}else if(bZ&&!cA){if(bY.a.emptyBranch()===_d.BYE)return[bY.b,bY.a];return[]}else if(!bY.a.score.isEmpty()&&!bY.b.score.isEmpty()){if(bY.a.score.get()>bY.b.score.get())return[bY.a,bY.b];if(bY.a.score.get()<bY.b.score.get())return[bY.b,bY.a]}return[]};bX.emptyTeam=(cB,cC)=>{var cD=new _f(cB, D.empty(), D.empty(), D.empty(), D.empty());cD.sibling=()=>cC;return cD};bX.prototype.winner=function(){return (bX.teamsInResultOrder(this)[0]||bX.emptyTeam(this.a.source,this.b))};bX.prototype.loser=function(){return (bX.teamsInResultOrder(this)[1]||bX.emptyTeam(this.b.source,this.a))};return bX}());function j(a){function df(cE,d){if(B(cE))return df(cE[0],d+1);return d}return df(a,0)}function k(a,d){d>0&&(a=k([a],d-1));return a}function L(cF,cG,cH){var cI=cH.find(`.team[data-teamid=${cF}]`),cJ=!cG?'highlight':cG;return{highlight:function(){cI.each(function(){$(this).addClass(cJ);$(this).hasClass('win')&&$(this).parent().find('.connector').addClass(cJ)})},deHighlight:function(){cI.each(function(){$(this).removeClass(cJ);$(this).parent().find('.connector').removeClass(cJ)})}}}function M(cK,w,f){var cL=f||w,cM=cL.winner(),_F=cL.loser();if(cM&&_F){!cM.name.isEmpty()&&L(cM.seed.get(),'highlightWinner',cK).highlight();!_F.name.isEmpty()&&L(_F.seed.get(),'highlightLoser',cK).highlight()}cK.find('.team').mouseover(function(){var cN=$(this).attr('data-teamid');if(cN===void 0)return;var cO=L(parseInt(cN,10),null,cK);cO.highlight();$(this).mouseout(function(){cO.deHighlight();$(this).unbind('mouseout')})})}function N(cP,cQ,cR){var cS=$('<input type="text">');cQ&&cS.val(cQ);cP.empty().append(cS);cS.focus();cS.blur(()=>cR(cS.val()));cS.keydown(e=>{var cT=e.keyCode||e.which;(cT===9||cT===13||cT===27)&&(e.preventDefault(),cR(cS.val(),cT!==27))})}function o(cU,cV,cW,cX){switch(cX) {case g.EMPTY_BYE:cU.append('BYE');return;case g.EMPTY_TBD:cU.append('TBD');return;case g.ENTRY_NO_SCORE:case g.ENTRY_DEFAULT_WIN:case g.ENTRY_COMPLETE:cU.append(cV!==null&&cV!==void 0?cV:'???');return}}function P(cY,cZ){}function q(dA){var dB=dA.el,dC=dB.find('.team.win');dC.append('<div class="bubble">1st</div>');var dD=dB.find('.team.lose');dD.append('<div class="bubble">2nd</div>');return!0}function R(dE){var dF=dE.el,dG=dF.find('.team.win');dG.append('<div class="bubble third">3rd</div>');var dH=dF.find('.team.lose');dH.append('<div class="bubble fourth">4th</div>');return!0}function v(dP,dQ,dR,dS,dT){var dU=Math.log(dQ.length*2)/Math.log(2),_g=dQ.length,H;for(var r=0;r<dU;r+=1){H=dP.addRound(D.empty());for(var m=0;m<_g;m+=1){var K=r===0?T(dQ,m):null;if(!(r===dU-1&&dR)&&!(r===dU-1&&dT))H.addMatch(K,D.empty());else{var _l=H.addMatch(K,D.of(q));!dT&&_l.setAlignCb(u(_l,dS.skipConsolationRound))}}_g/=2}if(dR){dP.final().setConnectorCb(D.empty());if(dQ.length>1&&!dS.skipConsolationRound){var _m=dP.final().getRound().prev(),_n=_m.map(p=>function(){return p.match(0).loser()}).toNull(),O=_m.map(p=>function(){return p.match(1).loser()}).toNull(),_p=H.addMatch(function(){return[{source:_n},{source:O}]},D.of(R));_p.setAlignCb(dV=>{var dW=dP.el.height()/2;_p.el.css({height:dW});var dX=dV.height()/2+dS.matchMargin;dV.css({top:dX})});_p.setConnectorCb(D.empty())}}}var W=function(dY,dZ,eA,m,n,r){return ()=>{if(n%2===0&&r===0)return[{source:function(){return dY.round(0).match(m*2).loser()}},{source:function(){return dY.round(0).match(m*2+1).loser()}}];var eB=r%2===0?eA-m-1:m;return[{source:function(){return dZ.round(r*2).match(m).winner()}},{source:function(){return dY.round(r+1).match(eB).loser()}}]}};function z(eL,eM,eN,eO,eP){var eQ=Math.log(eN*2)/Math.log(2)-1,_G=eN/2;for(var r=0;r<eQ;r+=1){var _I=eO&&r===eQ-1?1:2;for(var n=0;n<_I;n+=1){var _k=eM.addRound(D.empty());for(var m=0;m<_G;m+=1){var _M=!(n%2===0&&r!==0)?W(eL,eM,_G,m,n,r):null,_N=r===eQ-1&&eO,_o=_k.addMatch(_M,D.of(_N?R:null));_o.setAlignCb(X(_o.el.find('.teamContainer'),_o));if(_N)_o.setConnectorCb(D.empty());else if(r<eQ-1||n<1)n%2===0?_o.setConnectorCb(D.of(y(eP))):_o.setConnectorCb(D.empty())}}_G/=2}}function aA(eR,eS,eT,eU,eV){var eW=eR.addRound(D.empty()),eX=eW.addMatch(function(){return[{source:function(){return eS.winner()}},{source:function(){return eT.winner()}}]},D.of(eZ=>{var fA=!1;if(!eU.skipSecondaryFinal&&(!eZ.winner().name.isEmpty()&&eZ.winner().name===eT.winner().name)){if(eR.size()===2)return!1;var fB=function(){var fE=!eZ.winner().name.isEmpty()&&eZ.winner().name===eT.winner().name;if(fA===!1)fE&&(fA=!0,eV());(!fE&&fA)&&(fA=!1,eR.dropRound(),eV());return fE},fC=eR.addRound(D.of(fB)),fD=fC.addMatch(function(){return[{source:function(){return eZ.first()}},{source:function(){return eZ.second()}}]},D.of(q));eZ.setConnectorCb(D.of(tC=>({height:0,shift:tC.height()/2})));fD.setConnectorCb(D.empty());fD.setAlignCb(fF=>{var fG=eS.el.height()+eT.el.height();fD.el.css({height:fG});var fH=(eS.el.height()/2+eS.el.height()+eT.el.height()/2)/2-fF.height();fF.css({top:fH})});return!1}if(eR.size()===2)eR.dropRound();else if(eR.size()>2)throw Error('Unexpected number of final rounds');return q(eZ)}));eX.setAlignCb(fI=>{var fJ=(eS.el.height()+eT.el.height())/(eU.skipConsolationRound?1:2);eX.el.css({height:fJ});var fK=(eS.el.height()/2+eS.el.height()+eT.el.height()/2)/2-fI.height();fI.css({top:fK})});if(!eU.skipConsolationRound){var _h=eT.final().getRound().prev(),eY=eW.addMatch(function(){return[{source:function(){return _h.get().match(0).loser()}},{source:function(){return eT.loser()}}]},D.of(R));eY.setAlignCb(fL=>{var fM=(eS.el.height()+eT.el.height())/2;eY.el.css({height:fM});var fN=(eS.el.height()/2+eS.el.height()+eT.el.height()/2)/2+fL.height()/2-fM;fL.css({top:fN})});eX.setConnectorCb(D.empty());eY.setConnectorCb(D.empty())}eS.final().setConnectorCb(D.of(fO=>{var fP=fO.height()/4,fQ=(eS.el.height()/2+eS.el.height()+eT.el.height()/2)/2-fO.height()/2,fR=fQ-eS.el.height()/2;var fS=eS.winner().order.map(fV=>fV.map({height:fR+fP*2,shift:fP*(eU.centerConnectors?2:1)},{height:fR+fP*(eU.centerConnectors?2:0),shift:fP*(eU.centerConnectors?2:3)})).orElse({height:fR+fP*(eU.centerConnectors?2:1),shift:fP*2}),fT=fS.height,fU=fS.shift;return{height:fT-fO.height()/2,shift:fU}}));eT.final().setConnectorCb(D.of(fW=>{var fX=fW.height()/4,fY=(eS.el.height()/2+eS.el.height()+eT.el.height()/2)/2-fW.height()/2,fZ=fY-eS.el.height()/2;var gA=eT.winner().order.map(gD=>gD.map({height:fZ+fX*(eU.centerConnectors?2:0),shift:fX*(eU.centerConnectors?2:3)},{height:fZ+fX*2,shift:fX*(eU.centerConnectors?2:1)})).orElse({height:fZ+fX*(eU.centerConnectors?2:1),shift:fX*2}),gB=gA.height,gC=gA.shift;return{height:-(gB+fW.height()/2),shift:-gC}}))}function aB(gE,gF,gG){return gE.name.map(()=>gG.map(()=>g.ENTRY_COMPLETE).orElseGet(()=>gF.emptyBranch()===_d.BYE?g.ENTRY_DEFAULT_WIN:g.ENTRY_NO_SCORE)).orElseGet(()=>{var gH=gE.emptyBranch();switch(gH) {case _d.BYE:return g.EMPTY_BYE;case _d.TBD:return g.EMPTY_TBD;default:throw Error('Unexpected branch type '.concat(gH))}})}var aC=(function(){function gI(gJ,gK,gL,gM,gN,gO,gP,_H){this.bracket=gJ;this.previousRound=gK;this.roundNumber=gL;this.roundResults=gM;this.doRenderCb=gN;this.mkMatch=gO;this.isFirstBracket=gP;this.opts=_H;this.matches=[];this.containerWidth=this.opts.teamWidth+this.opts.scoreWidth;this.roundCon=$('<div class=\"round\" style=\"width: '.concat(this.containerWidth,'px; margin-right: ').concat(this.opts.roundMargin,'px\"/>'))}E(gI.prototype,'el',{get:function(){return this.roundCon},enumerable:!1,configurable:!0});gI.prototype.addMatch=function(gQ,gR){var gS=this,gT=this.matches.length,gU=gQ!==null?gQ():[{source:function(){return gS.bracket.round(gS.roundNumber-1).match(gT*2).winner()}},{source:function(){return gS.bracket.round(gS.roundNumber-1).match(gT*2+1).winner()}}],gV=function(){return gU[0].source()},gW=function(){return gU[1].source()};var gX=new _f(gV, gV().name, D.of(_e.first()), gV().seed, D.empty());var gY=new _f(gW, gW().name, D.of(_e.second()), gW().seed, D.empty());gX.sibling=()=>gY;gY.sibling=()=>gX;var J=this.mkMatch(this,new I(gX, gY),gT,this.roundResults.map(function(r){return r[gT]===void 0?null:r[gT]}),gR,this.isFirstBracket,this.opts);this.matches.push(J);return J};gI.prototype.match=function(id){return this.matches[id]};gI.prototype.prev=function(){return this.previousRound};gI.prototype.size=function(){return this.matches.length};gI.prototype.render=function(){this.roundCon.empty();if(!this.doRenderCb.isEmpty()&&!this.doRenderCb.get()())return;this.roundCon.appendTo(this.bracket.el);for(const m of this.matches){m.render();continue}};gI.prototype.results=function(){return this.matches.reduce(function(gZ,m){return gZ.concat([m.results()])},[])};return gI}());function aF(hQ,hR,hS){var hT,hU;var hV=hR.shift,hY=hQ/2,_j=hV>=0,_K=$('<div class="connector"></div>').css(hT={},hT[hS]=-hY-2,hT.borderBottom=hX?'none':'',hT.borderTop=!hX?'none':'',hT.bottom=!_j?-hV-1:'',hT.height=hW.height,hT.top=_j?hV-1:'',hT.width=hY,hT);var hW=aE(hR.height),hX=hW.drop;return _K.append($('<div class="connector"></div>').css(hU={},hU[hS]=-hY,hU.bottom=hX?0:'',hU.top=!hX?0:'',hU.width=hY,hU))}function aG(hZ,iA,iB,iC,iD){if(iA)return Math.log(hZ*2)/Math.log(2);if(iB)return Math.max(2,(Math.log(hZ*2)/Math.log(2)-1)*2-1);var iE=!iC&&(iD.length===3&&iD[2].length===2);return ((Math.log(hZ*2)/Math.log(2)-1)*2+1+(iE?1:0))}function aH(iF){var iG=$.extend(!0,{},iF);iG.teams=iG.teams.map(ts=>ts.map(t=>t.toNull()));iG.results=iG.results.map(iH=>iH.map(iI=>iI.map(iJ=>{if(iJ.matchData!==void 0)return[iJ.first.toNull(),iJ.second.toNull(),iJ.matchData];return[iJ.first.toNull(),iJ.second.toNull()]})));return iG}var aI=(function(){function iK(){this.counter=0}iK.prototype.get=function(){return this.counter};iK.prototype.getNext=function(){return ++this.counter};iK.prototype.reset=function(){this.counter=0};return iK}());function aJ(iL,iM,iN,iO,iP,iQ,iR,iS,iT,_J){var iU=$('<div class=\"score\" style=\"width: '.concat(iR.scoreWidth,'px;\" ').concat(iN.name.isEmpty()||iO.name.isEmpty()?'':'data-resultid=\"result-'.concat(iS.getNext(),'\"'),'></div>')),_L=iN.name.isEmpty()||iO.name.isEmpty()||!iP?D.empty():iN.score,iW=$('<div class=\"label\" style=\"width: '.concat(iR.teamWidth,'px;\"></div>')).appendTo(iV);iU.text(iR.extension.scoreToString(_L.toNull()));var iV=$('<div class=\"team\" style=\"width: '.concat(iR.teamWidth+iR.scoreWidth,'px;\"></div>'));iR.decorator.render(iW,iN.name.toNull(),iN.score.toNull(),aB(iN,iO,iN.score));for(const seed of iN.seed)iV.attr('data-teamid',seed);if(iN.name.isEmpty())iV.addClass('na');else if(iM.winner().name===iN.name)iV.addClass('win');else iM.loser().name===iN.name&&iV.addClass('lose');iV.append(iU);if((!iN.name.isEmpty()||(iN.name.isEmpty()&&iL===0&&iQ))&&c(iR.save)){!iR.disableTeamEdit&&(iW.addClass('editable'),iW.click(function(){var iX=$(this);function iY(){function iZ(jA,jB){var jC=iN.seed.get();iR.init.teams[~~(jC/2)][jC%2]=D.of(jA||null);_J(!0);iX.click(iY);var jD=iR.el.find('.team[data-teamid='+(jC+1)+'] div.label:first');if(jD.length&&jB===!0&&iL===0)$(jD).click()}iX.unbind();iR.decorator.edit(iX,iN.name.toNull(),iZ)}iY()}));if(!iN.name.isEmpty()&&!iO.name.isEmpty()&&iP){var _O=iS.get();iU.addClass('editable');iU.click(function(){var jE=$(this);function jF(){jE.unbind();var jG='0';(iN.score!==null&&G(iN.score.get()))&&(jG=jE.text());var jH=$('<input type="text">');jH.val(jG);jE.empty().append(jH);jH.focus().select();jH.keydown(function(e){!G($(this).val())?$(this).addClass('error'):$(this).removeClass('error');var jI=e.keyCode||e.which;if(jI===9||jI===13||jI===27){e.preventDefault();$(this).blur();if(jI===27)return;var jJ=iT.find('div.score[data-resultid=result-'+(_O+1)+']');jJ?.click()}});jH.blur(()=>{var jK=iR.extension.evaluateScore(jH.val(),iN.score.toNull());jK===null&&(jK=iN.score);jE.html(jK);G(jK)&&(iN.score=D.of(jK),_J(!0));jE.click(jF)})}jF()})}}return iV}function aO(lM){return $('<span class="increment">+</span>').click(lM)}function aP(lN){return $('<span class="decrement">-</span>').click(lN)}function aQ(lO){return $('<span class="doubleElimination">de</span>').click(lO)}function aR(lP){return $('<span class="singleElimination">se</span>').click(lP)}function aS(lQ,lR){var lS=lQ.teams.length,lT=lQ.results.length,lU=$('<div class="tools"></div>');lU.append(function(){return aO(()=>{for(var i=0;i<lS;i+=1)lQ.teams.push([D.empty(),D.empty()]);return aN(lR)})}());((lS>1&&lT===1)||(lS>2&&lT===3))&&lU.append(function(){return aP(()=>{if(lS>1){lQ.teams=lQ.teams.slice(0,lS/2);return aN(lR)}})}());if(lT===1&&lS>1)lU.append(function(){return aQ(()=>{if(lS>1&&lT<3){lQ.results.push([],[]);return aN(lR)}})}());else (lT===3&&lS>1)&&lU.append(function(){return aR(()=>{if(lT===3){lQ.results=lQ.results.slice(0,1);return aN(lR)}})}());return lU}var aT=function(lV){if(typeof lV!=='number')throw Error('Value is not a number');return lV};function aX(lZ){(!lZ.save&&lZ.disableTeamEdit)&&$.error('disableTeamEdit can be used only if the bracket is editable, i.e. "save" callback given');(!lZ.disableToolbar&&lZ.disableTeamEdit)&&$.error('disableTeamEdit requires also resizing to be disabled, initialize with "disableToolbar: true"')}function aY(mA,mB,mC){var mD={centerConnectors:!mA.hasOwnProperty('centerConnectors')?!1:aU(mA.centerConnectors),decorator:mA.decorator,dir:aZ(mA.dir),disableHighlight:!mA.hasOwnProperty('disableHighlight')?!1:aU(mA.disableHighlight),disableTeamEdit:!mA.hasOwnProperty('disableTeamEdit')?!1:aU(mA.disableTeamEdit),disableToolbar:mA.disableToolbar,el:mB,extension:mC,init:bB(mA.init),matchMargin:!mA.hasOwnProperty('matchMargin')?20:aV(mA.matchMargin),onMatchClick:mA.onMatchClick||function(){},onMatchHover:mA.onMatchHover||function(){},roundMargin:!mA.hasOwnProperty('roundMargin')?40:aV(mA.roundMargin),save:mA.save,scoreWidth:!mA.hasOwnProperty('scoreWidth')?30:aV(mA.scoreWidth),skipConsolationRound:mA.skipConsolationRound||!1,skipGrandFinalComeback:mA.skipGrandFinalComeback||!1,skipSecondaryFinal:mA.skipSecondaryFinal||!1,teamWidth:!mA.hasOwnProperty('teamWidth')?70:aV(mA.teamWidth),userData:mA.userData};aX(mD);return mD}function aZ(mE){if(mE===void 0)return'lr';if(mE!=='lr'&&mE!=='rl')throw Error('Direction must be either: "lr" or "rl"');return mE}function bA(mF,mG){if((!mF||!G(mF))&&!G(mG))return 0;if(G(mF))return parseInt(mF,10);return null}function bB(mH){var mI=mH||{results:[],teams:[[null,null]]},mK=aM(k(mI.results,4-j(mI.results)));if(mI.teams===void 0)throw Error('Teams missing');if(mI.results===void 0)throw Error('Results missing');var mJ=aW(mI.teams.length);mJ!==~~mJ&&$.error('\"teams\" property must have 2^n number of team pairs, i.e. 1, 2, 4, etc. Got '.concat(mI.teams.length,' team pairs.'));return{results:mK,teams:!mI.teams||mI.teams.length===0?[[D.empty(),D.empty()]]:mI.teams.map(ts=>ts.map(t=>(t===null?D.empty():D.of(t))))}}function bC(mL,mM,mN){if(!mM)throw Error('Options not set');if(!mM.init&&!mM.save)throw Error('No bracket data or save callback given');var mO=$.extend(!0,{},mM),mQ=mO.hasOwnProperty('disableToolbar');if(mO.decorator&&(!mO.decorator.edit||!mO.decorator.render))throw Error('Invalid decorator input');(mO.save&&(mO.onMatchClick||mO.onMatchHover))&&$.error('Match callbacks may not be passed in edit mode (in conjunction with save callback)');var mP=typeof mO.disableToolbar;(mQ&&mP!=='boolean')&&$.error('disableToolbar must be a boolean, got '.concat(mP));(!mO.save&&mQ)&&$.error('disableToolbar can be used only if the bracket is editable, i.e. "save" callback given');!mQ&&(mO.disableToolbar=mO.save===void 0);var mR=aN(aY(mM,mL,mN));$(mL).data('bracket',{target:mL,obj:mR});return mR}function bD(mS){return typeof mS==='object'||mS===void 0}$.fn.bracket=function(mT){if(A(mT)&&mT==='data'){var mU=$(this).data('bracket');return mU.obj.data()}if(bD(mT)){var mV=mT;!mV.decorator&&(mV.decorator={edit:N,render:o,renderMatch:P});!mV.decorator.edit&&(mV.decorator.edit=N);!mV.decorator.render&&(mV.decorator.render=o);!mV.decorator.renderMatch&&(mV.decorator.renderMatch=P);return bC(this,F({},mV),{evaluateScore:bA,scoreToString:function(mW){return mW===null?'--':`${mW}`}})}$.error(`Method ${mT} does not exist on jQuery.bracket`)}})(jQuery);
